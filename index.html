<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Agr√≠cola IoT</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #e3f2fd, #c8e6c9);
    color: #333;
    margin: 0;
    padding: 0;
  }
  .container {
    margin-top: 40px;
  }
  .card {
    display: inline-block;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 20px 40px;
    margin: 20px;
    transition: 0.3s;
  }
  .card:hover {
    transform: scale(1.05);
  }
  h2 {
    margin: 10px 0;
  }
  button {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover {
    background: #45a049;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üå± Panel de Monitoreo Agr√≠cola IoT</h1>

    <div class="card">
      <h2>üå°Ô∏è Temperatura</h2>
      <p id="temp">-- ¬∞C</p>
    </div>

    <div class="card">
      <h2>üíß Humedad</h2>
      <p id="hum">-- %</p>
    </div>

    <div class="card">
      <h2>üîå Actuador</h2>
      <button id="btnActuador" onclick="toggleActuador()">Cargar...</button>
    </div>
  </div>

  <script>
    const TOKEN = "zrdV3o792LQYmIgyI3h7Tl8e_2HjXbjq";

    async function actualizarDatos() {
      try {
        // Leer temperatura (V1) y humedad (V2)
        const [tempRes, humRes, actRes] = await Promise.all([
          fetch(`https://blynk.cloud/external/api/get?token=${TOKEN}&V1`),
          fetch(`https://blynk.cloud/external/api/get?token=${TOKEN}&V2`),
          fetch(`https://blynk.cloud/external/api/get?token=${TOKEN}&V4`)
        ]);

        const temp = await tempRes.text();
        const hum = await humRes.text();
        const act = await actRes.text();

        document.getElementById("temp").innerText = temp + " ¬∞C";
        document.getElementById("hum").innerText = hum + " %";
        document.getElementById("btnActuador").innerText = act === "1" ? "Apagar" : "Encender";
        document.getElementById("btnActuador").style.background = act === "1" ? "#d32f2f" : "#4CAF50";
      } catch (err) {
        console.error("Error al obtener datos:", err);
      }
    }

    async function toggleActuador() {
      const actBtn = document.getElementById("btnActuador");
      const currentState = actBtn.innerText === "Apagar" ? 1 : 0;
      const newState = currentState === 1 ? 0 : 1;

      await fetch(`https://blynk.cloud/external/api/update?token=${TOKEN}&V4=${newState}`);
      actualizarDatos();
    }

    actualizarDatos();
    setInterval(actualizarDatos, 3000); // refrescar cada 3s
  </script>
</body>
</html>
